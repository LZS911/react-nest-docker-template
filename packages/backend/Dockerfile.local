FROM node:16.16.0-alpine
WORKDIR /projects
COPY ./pnpm-lock.yaml ./

RUN npm install -g pnpm@8.3.1
RUN pnpm fetch

COPY . .

RUN pnpm install -r --offline

VOLUME ["/projects/node_modules/", "/projects/packages/backend/node_modules/", "/projects/.pnpm-store/"]

# Value set in .env file.
EXPOSE $BACKEND_PORT
CMD rm -rf dist && cd packages/backend && pnpm start:debug